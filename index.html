<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Jungian Psyche Mandala</title>

<style>
/* -------------------------------------------------- */
/* 1. Fluid scale unit: 90 % of the shorter viewport  */
/* -------------------------------------------------- */
:root{
  --base: 1100;                                 /* design size (px)           */
  --u: calc(90vmin / var(--base));              /* 0.9 × shorter viewport     */
  --fs: clamp(0.8rem, 2vw, 1.1rem);             /* readable across devices    */
  --gap-sm: calc(4px  * var(--u));
  --gap-lg: calc(10px * var(--u));
}

/* 2. Page centring + dark canvas backdrop */
html,body{
  height:100%;margin:0;
  display:flex;justify-content:center;align-items:center;
  background:#000;color:#fff;font:var(--fs)/1.4 system-ui, sans-serif;
  user-select:none;touch-action:none;    
  font-size: 0.85rem;       /* avoid 2-finger zoom drag   */
}

/* 3. Main container always fits screen */
.psychic-model{
  position:relative;
  inline-size:calc(1100px * var(--u));
  block-size:calc(1100px * var(--u));
}

/* 4. Generic node */
.node{
  --diameter: calc(var(--size)  * var(--u));
  --radius  : calc(var(--rBase) * var(--u));

  position:absolute;inset-inline-start:50%;inset-block-start:50%;
  translate:-50% -50%;
  transform:
    rotate(var(--angle))
    translate(var(--radius))
    rotate(calc(-1*var(--angle)));

  inline-size:var(--diameter);block-size:var(--diameter);
  border-radius:50%;
  display:flex;justify-content:center;align-items:center;
  text-align:center;font-size:calc(14px * var(--u) + 0.5vmin);
  padding:var(--gap-lg);
  cursor:grab;transition:transform .4s ease;
  font-family:JetBrains Mono, monospace;font-weight:700;
}
.node:active{cursor:grabbing}

/* 5. Outline ring */
.ring{
  position:absolute;inset:0;
  border:calc(2px * var(--u)) solid #fff;border-radius:50%;
  pointer-events:none;
}

/* 6. Tooltip */
.definitions .def{
  position:fixed;top:1rem;inset-inline-end:1rem;
  max-inline-size:260px;padding:.75rem 1rem;
  background:#141414e6;border-radius:8px;
  box-shadow:0 4px 12px #0007;
  pointer-events:none;opacity:0;transition:opacity .15s;
  font:0.9rem/1.3 JetBrains Mono, monospace;
}
.node:is(:hover,:focus-visible):nth-of-type(1) ~ .definitions .def:nth-child(1),
.node:is(:hover,:focus-visible):nth-of-type(2) ~ .definitions .def:nth-child(2),
.node:is(:hover,:focus-visible):nth-of-type(3) ~ .definitions .def:nth-child(3),
.node:is(:hover,:focus-visible):nth-of-type(4) ~ .definitions .def:nth-child(4),
.node:is(:hover,:focus-visible):nth-of-type(5) ~ .definitions .def:nth-child(5),
.node:is(:hover,:focus-visible):nth-of-type(6) ~ .definitions .def:nth-child(6),
.node:is(:hover,:focus-visible):nth-of-type(7) ~ .definitions .def:nth-child(7){
  opacity:1;
}

/* 7. Canvas behind everything */
canvas{position:fixed;inset:0;z-index:-1;background:#000}

/* 8. Control panel collapses on small screens */
#controls{
  position:fixed;bottom:1rem;left:1rem;
  padding:.6rem 1rem;background:#111d;border-radius:6px;
  font:0.75rem/1.4 system-ui,sans-serif;opacity:.85;
  backdrop-filter:blur(3px);transition:.3s;
}
#controls label{display:block;margin-top:.4rem}
@media(max-width:480px){
  #controls[data-collapsed="true"]{
    inline-size:auto;padding:.4rem;block-size:auto;
  }
  #controls[data-collapsed="true"] label{display:none}
  #toggle{
    display:inline-block;background:#222;border:none;color:#fff;
    padding:.25rem .6rem;border-radius:4px;font-size:.75rem;
  }
}
</style>
</head>
<body>

<div class="psychic-model">
  <!-- radius(px) | size(px) | angle -->
  <div class="node" style="--rBase:0;   --size:200; --angle:0deg;               background:lightblue;">Self</div>
  <div class="node" style="--rBase:175; --size:80;  --angle:0deg;  z-index:12;  background:antiquewhite;">Persona</div>
  <div class="node" style="--rBase:100; --size:100; --angle:0deg;               background:#f39c12;">Ego</div>
  <div class="node" style="--rBase:190; --size:100; --angle:210deg; z-index:12; background:#2c3e50;">Shadow</div>
  <div class="node" style="--rBase:190; --size:100; --angle:-210deg;z-index:12; background:#e74c3c;">Anima / Animus</div>
  <div class="node" style="--rBase:130; --size:150; --angle:180deg; z-index:1;  background:#8e44ad;">Personal<br>Unconscious</div>
  <div class="node" style="--rBase:280; --size:200; --angle:180deg;            background:#3498db;">Collective<br>Unconscious</div>

  <div class="ring"></div>

  <div class="definitions">
    <div class="def">Self: The conscious ego, representing the individual's sense of identity.</div>
    <div class="def">Persona: The social mask one wears in public, shaped by societal expectations.</div>
    <div class="def">Ego: The rational part of the psyche, mediating between the self and the external world.</div>
    <div class="def">Shadow: The repressed, darker aspects of the personality, often projected onto others.</div>
    <div class="def">Anima/Animus: The inner feminine/masculine aspects of the psyche, guiding personal growth.</div>
    <div class="def">Personal Unconscious: The unique experiences and memories that shape the individual.</div>
    <div class="def">Collective Unconscious: The shared, universal symbols and archetypes present in all humans.</div>
  </div>
</div>

<canvas id="c"></canvas>

<!-- collapsible control panel -->
<div id="controls" data-collapsed="false">
  <button id="toggle" hidden>▲</button>
  <label>Line width
    <input type="range" id="lw" min="1" max="20" value="4">
  </label>
  <label>Spacing
    <input type="range" id="sp" min="0.5" max="10" step="0.5" value="2">
  </label>
  <label>Angle step
    <input type="range" id="as" min="0.05" max="0.5" step="0.05" value="0.1">
  </label>
  <label>Rotation speed
    <input type="range" id="rs" min="0" max="0.1" step="0.005" value="0.02">
  </label>
</div>

<script>
/* ------------------------------------------------------------------ */
/* 1. Spiral animation on the full-screen canvas                      */
/* ------------------------------------------------------------------ */
let DOTS = 600, SPACING = 2, ANGLE_STEP = 0.1, SPEED = 0.02;

const canvas = document.getElementById('c');
const ctx    = canvas.getContext('2d', { alpha:false });

function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
addEventListener('resize', resize, { passive:true }); resize();

ctx.lineCap = 'round'; ctx.strokeStyle = '#fff';
ctx.lineWidth = 4;

let t = 0;
function draw(){
  ctx.fillStyle = '#000a';          // translucent wipe
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.save();
  ctx.translate(canvas.width/2, canvas.height/2);

  ctx.beginPath();
  for (let i = 0; i < DOTS; i++){
    const a = ANGLE_STEP*i + t, r = SPACING*i;
    const x = r * Math.cos(a), y = r * Math.sin(a);
    i ? ctx.lineTo(x,y) : ctx.moveTo(x,y);
  }
  ctx.stroke(); ctx.restore();

  t += SPEED;
  requestAnimationFrame(draw);
}
draw();

/* ------------------------------------------------------------------ */
/* 2. Sliders control spiral params                                   */
/* ------------------------------------------------------------------ */
const byId = id => document.getElementById(id);
byId('lw').oninput = e => ctx.lineWidth = +e.target.value;
byId('sp').oninput = e => SPACING      = +e.target.value;
byId('as').oninput = e => ANGLE_STEP   = +e.target.value;
byId('rs').oninput = e => SPEED        = +e.target.value;

/* ------------------------------------------------------------------ */
/* 3. Collapsible controls on very narrow screens                     */
/* ------------------------------------------------------------------ */
const controls = byId('controls'), toggle = byId('toggle');
if (matchMedia('(max-width:480px)').matches){ toggle.hidden = false; }
toggle.addEventListener('click', ()=>{
  const collapsed = controls.dataset.collapsed === 'true';
  controls.dataset.collapsed = collapsed ? 'false' : 'true';
  toggle.textContent = collapsed ? '▼' : '▲';
});

/* ------------------------------------------------------------------ */
/* 4. Draggable nodes (pointer API)                                   */
/* ------------------------------------------------------------------ */
document.querySelectorAll('.node').forEach(node=>{
  let originMatrix, startX, startY, dragging=false;

  node.addEventListener('pointerdown', e=>{
    e.preventDefault(); node.setPointerCapture(e.pointerId);
    originMatrix = getComputedStyle(node).transform;   // cache
    startX = e.clientX; startY = e.clientY; dragging = true;
    node.style.transition = 'none';
  });

  node.addEventListener('pointermove', e=>{
    if(!dragging || !node.hasPointerCapture(e.pointerId)) return;
    node.style.transform = `${originMatrix} translate(${e.clientX-startX}px,${e.clientY-startY}px)`;
  });

  node.addEventListener('pointerup', e=>{
    if(!dragging) return; dragging=false; node.releasePointerCapture(e.pointerId);
    node.style.transition = 'transform .6s cubic-bezier(.17,.67,.43,1.31)';
    node.style.transform  = originMatrix;
    node.addEventListener('transitionend',()=>{
      node.style.transition=''; node.style.transform='';
    }, { once:true });
  });
});
</script>
</body>
</html>
